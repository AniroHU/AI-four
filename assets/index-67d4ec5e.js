var ee=Object.defineProperty;var te=(t,n,e)=>n in t?ee(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e;var c=(t,n,e)=>(te(t,typeof n!="symbol"?n+"":n,e),e);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();class Y{constructor(n){c(this,"boardPiece");this.boardPiece=n}}const L=10**9+7,O=-L;function ne(t,n,e){return(t.x-n)*(t.x-n)<=e*e}function $(t){for(let n=0;n<a.COLUMNS;n++)if(ne(t,3*a.PIECE_RADIUS*n+a.MASK_X_BEGIN+2*a.PIECE_RADIUS,a.PIECE_RADIUS))return n;return-1}function N(t){return t[Math.floor(Math.random()*t.length)]}function X(t){const n=[];for(let e=0;e<t.length;e++)n[e]=t[e].slice();return n}function U(t,n,e){const o=X(t);if(o[0][e]!==h.EMPTY||e<0||e>=a.COLUMNS)return{success:!1,map:o};let s=!1,i=0;for(let r=0;r<a.ROWS-1;r++)if(o[r+1][e]!==h.EMPTY){s=!0,i=r;break}return s||(i=a.ROWS-1),o[i][e]=n,{success:!0,map:o}}var h=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLAYER_1=1]="PLAYER_1",t[t.PLAYER_2=2]="PLAYER_2",t[t.DRAW=3]="DRAW",t))(h||{});const u=class{constructor(){c(this,"map");c(this,"winnerBoardPiece");this.map=[],this.winnerBoardPiece=0,this.initConstants(),this.reset()}reset(){this.map=[];for(let n=0;n<u.ROWS;n++){this.map.push([]);for(let e=0;e<u.COLUMNS;e++)this.map[n].push(0)}this.winnerBoardPiece=0}initConstants(){u.CANVAS_HEIGHT=u.SCALE*480,u.CANVAS_WIDTH=u.SCALE*640,u.PIECE_RADIUS=u.SCALE*25,u.MASK_X_BEGIN=Math.max(0,u.CANVAS_WIDTH-(3*u.COLUMNS+1)*u.PIECE_RADIUS)/2,u.MASK_Y_BEGIN=Math.max(0,u.CANVAS_HEIGHT-(3*u.ROWS+1)*u.PIECE_RADIUS)/2,u.MESSAGE_WIDTH=u.SCALE*400,u.MESSAGE_X_BEGIN=(u.CANVAS_WIDTH-u.MESSAGE_WIDTH)/2,u.MESSAGE_Y_BEGIN=u.SCALE*20}async applyPlayerAction(n,e){const{success:o,map:s}=U(this.map,n.boardPiece,e);return this.map=s,o}debug(){console.log(this.map.map(n=>n.join(" ")).join(`
`))}getWinner(){if(this.winnerBoardPiece!==0)return this.winnerBoardPiece;const n=[[0,-1],[0,1],[-1,-1],[-1,0],[-1,1],[1,-1],[1,0],[1,1]],e=(s,i,r,l,d)=>d>=4?!0:s<0||i<0||s>=u.ROWS||i>=u.COLUMNS||this.map[s][i]!==r?!1:e(s+l[0],i+l[1],r,l,d+1);let o=0;for(let s=0;s<u.ROWS;s++)for(let i=0;i<u.COLUMNS;i++){const r=this.map[s][i];if(r!==0){for(let l=0;l<n.length;l++)if(e(s+n[l][0],i+n[l][1],r,n[l],1))return this.winnerBoardPiece=r}else o++}return o===0?this.winnerBoardPiece=3:0}getPlayerColor(n){switch(n){case 1:return u.PLAYER_1_COLOR;case 2:return u.PLAYER_2_COLOR;default:return"transparent"}}};let a=u;c(a,"ROWS",6),c(a,"COLUMNS",7),c(a,"PLAYER_1_COLOR","#ef453b"),c(a,"PLAYER_2_COLOR","#0059ff"),c(a,"PIECE_STROKE_STYLE","black"),c(a,"MASK_COLOR","#d8d8d8"),c(a,"CANVAS_HEIGHT"),c(a,"CANVAS_WIDTH"),c(a,"PIECE_RADIUS"),c(a,"MASK_X_BEGIN"),c(a,"MASK_Y_BEGIN"),c(a,"MESSAGE_WIDTH"),c(a,"MESSAGE_X_BEGIN"),c(a,"MESSAGE_Y_BEGIN"),c(a,"SCALE");const B=class extends Y{constructor(e){super(e);c(this,"ownBoardPieceValue");c(this,"enemyBoardPiece");this.ownBoardPieceValue=this.getBoardPieceValue(e),this.enemyBoardPiece=e===h.PLAYER_1?h.PLAYER_2:h.PLAYER_1}getBoardPieceValue(e){return e===h.EMPTY?0:e===this.boardPiece?1:-1}getStateValue(e){let o=h.EMPTY,s=0;for(let i=0;i<a.ROWS;i++)for(let r=0;r<a.COLUMNS;r++){let l=0,d=0,E=0,y=0;for(let m=0;m<=3;m++)r+m<a.COLUMNS&&(l+=this.getBoardPieceValue(e[i][r+m])),i+m<a.ROWS&&(d+=this.getBoardPieceValue(e[i+m][r])),i+m<a.ROWS&&r+m<a.COLUMNS&&(E+=this.getBoardPieceValue(e[i+m][r+m])),i-m>=0&&r+m<7&&(y+=this.getBoardPieceValue(e[i-m][r+m]));s+=l*l*l,s+=d*d*d,s+=E*E*E,s+=y*y*y,Math.abs(l)===4?o=l>0?this.boardPiece:this.enemyBoardPiece:Math.abs(d)===4?o=d>0?this.boardPiece:this.enemyBoardPiece:Math.abs(E)===4?o=E>0?this.boardPiece:this.enemyBoardPiece:Math.abs(y)===4&&(o=y>0?this.boardPiece:this.enemyBoardPiece)}return{winnerBoardPiece:o,chain:s}}transformValues(e,o,s){const i=o===this.boardPiece,r=o===this.enemyBoardPiece;return e-=s*s,i?e=L-100-s*s:r&&(e=O+100+s*s),e}getMove(e,o,s,i){const r=this.getStateValue(e),l=r.winnerBoardPiece===this.boardPiece,d=r.winnerBoardPiece===this.enemyBoardPiece;return o>=B.MAX_DEPTH||l||d?{value:this.transformValues(r.chain,r.winnerBoardPiece,o)*this.ownBoardPieceValue,move:-1}:o%2===0?this.minState(e,o+1,s,i):this.maxState(e,o+1,s,i)}maxState(e,o,s,i){let r=O,l=[];for(let d=0;d<a.COLUMNS;d++){const{success:E,map:y}=U(e,this.boardPiece,d);if(!E)continue;const{value:m}=this.getMove(y,o,s,i);if(m>r?(r=m,l=[d]):m===r&&l.push(d),r>i)return{value:r,move:N(l)};s=Math.max(s,r)}return{value:r,move:N(l)}}minState(e,o,s,i){let r=L,l=[];for(let d=0;d<a.COLUMNS;d++){const{success:E,map:y}=U(e,this.enemyBoardPiece,d);if(!E)continue;const{value:m}=this.getMove(y,o,s,i);if(m<r?(r=m,l=[d]):m===r&&l.push(d),r<s)return{value:r,move:N(l)};i=Math.min(i,r)}return{value:r,move:N(l)}}async getAction(e){const o=X(e.map),s=this.maxState(o,0,O,L);return console.log(`AI ${this.boardPiece} choose column ${s.move} with value of ${s.value}`),s.move}};let p=B;c(p,"MAX_DEPTH",4);class g extends Y{constructor(e){super(e);c(this,"clickPromiseResolver");this.clickPromiseResolver=null}doAction(e){this.clickPromiseResolver&&0<=e&&e<a.COLUMNS&&this.clickPromiseResolver(e)}getAction(e){return new Promise(o=>this.clickPromiseResolver=o)}}class K extends Y{constructor(e){super(e);c(this,"actionPromiseResolver");this.actionPromiseResolver=null}doAction(e){this.actionPromiseResolver&&0<=e&&e<a.COLUMNS&&this.actionPromiseResolver(e)}getAction(e){return new Promise(o=>this.actionPromiseResolver=o)}}class Q{constructor(n,e){c(this,"board");c(this,"players");c(this,"currentPlayerId");c(this,"isMoveAllowed",!1);c(this,"isGameWon",!1);this.board=e,this.players=n,this.currentPlayerId=0,this.reset()}reset(){this.isMoveAllowed=!1,this.isGameWon=!1,this.board.reset()}async start(){for(this.isMoveAllowed=!0;!this.isGameWon;){await this.move();const n=this.board.getWinner();if(n!==h.EMPTY){console.log("[GameBase] Game over: winner is player ",n),this.isGameWon=!0,this.isMoveAllowed=!1,this.announceWinner(n);break}}}async move(){if(!this.isMoveAllowed)return;const n=this.players[this.currentPlayerId];let e=!1;for(;!e;){this.waitingForMove();const o=await n.getAction(this.board);this.isMoveAllowed=!1,this.beforeMoveApplied(o),e=await this.board.applyPlayerAction(n,o),this.isMoveAllowed=!0,e?this.afterMove(o):console.log("Move not allowed! Try again.")}this.currentPlayerId=this.getNextPlayer()}announceWinner(n){const e={[h.DRAW]:"draw",[h.PLAYER_1]:"Player 1",[h.PLAYER_2]:"Player 2",[h.EMPTY]:"none"}[n];console.log("[GameBase] Game over: winner is ",e,n)}getNextPlayer(){return this.currentPlayerId===0?1:0}}var C=(t=>(t.NEW_PLAYER_CONNECTION_REQUEST="NEW_PLAYER_CONNECTION_REQUEST",t.NEW_PLAYER_CONNECTION_OK="NEW_PLAYER_CONNECTION_OK",t.NEW_MATCH_REQUEST="NEW_MATCH_REQUEST",t.NEW_MATCH_OK="NEW_MATCH_OK",t.GAME_READY="GAME_READY",t.GAME_ENDED="GAME_ENDED",t.GAME_RESET="GAME_RESET",t.CONNECT_MATCH_REQUEST="CONNECT_MATCH_REQUEST",t.CONNECT_MATCH_OK="CONNECT_MATCH_OK",t.CONNECT_MATCH_FAIL="CONNECT_MATCH_FAIL",t.HUNG_UP="HUNG_UP",t.OTHER_PLAYER_HUNGUP="OTHER_PLAYER_HUNGUP",t.MOVE_MAIN="MOVE_MAIN",t.MOVE_SHADOW="MOVE_SHADOW",t))(C||{});function v(t,n){return console.log("[ws] send: ",t,n),JSON.stringify({type:t,payload:n||{}})}function se(t){const n=JSON.parse(t);return console.log("[ws] receive: ",n),n}function ie(){const t=[];let n=!1;function e(){n||(n=!0,window.requestAnimationFrame?window.requestAnimationFrame(o):setTimeout(o,66))}function o(){t.forEach(i=>{i()}),n=!1}function s(i){i&&t.push(i)}return{add:i=>{t.length||window.addEventListener("resize",e),s(i)}}}function q(t,{x:n=0,y:e=0,r:o=0,fillStyle:s="",strokeStyle:i=""}){t.save(),t.fillStyle=s,t.strokeStyle=i,t.beginPath(),t.arc(n,e,o,0,2*Math.PI,!1),t.fill(),t.restore()}function oe(t){const n=t.context;n.save(),n.fillStyle=f.MASK_COLOR,n.beginPath();const e=2*f.PIECE_RADIUS,o=3*f.PIECE_RADIUS;for(let s=0;s<f.ROWS;s++)for(let i=0;i<f.COLUMNS;i++)n.arc(o*i+f.MASK_X_BEGIN+e,o*s+f.MASK_Y_BEGIN+e,f.PIECE_RADIUS,0,2*Math.PI),n.rect(o*i+f.MASK_X_BEGIN+2*e,o*s+f.MASK_Y_BEGIN,-2*e,2*e);n.fill(),n.restore()}function b(t){t.context.clearRect(0,0,f.CANVAS_WIDTH,f.CANVAS_HEIGHT)}function H(){let t=null;const n=new Promise(e=>t=e);return t&&window.requestAnimationFrame(t),n}class f extends a{constructor(e){super();c(this,"canvas");c(this,"context");this.canvas=e,this.context=e.getContext("2d"),this.getBoardScale(),this.initConstants(),this.reset(),this.onresize()}getBoardScale(){return window.innerWidth<640?a.SCALE=.5:a.SCALE=1}onresize(){let e=a.SCALE;ie().add(()=>{this.getBoardScale(),e!==a.SCALE&&(e=a.SCALE,this.initConstants(),b(this),this.render())})}reset(){super.reset(),this.canvas&&(b(this),this.render())}initConstants(){if(super.initConstants(),this.canvas){const e=self.devicePixelRatio||1;this.canvas.width=f.CANVAS_WIDTH*e,this.canvas.height=f.CANVAS_HEIGHT*e,this.context.scale(e,e),this.canvas.style.width=f.CANVAS_WIDTH+"px",this.canvas.style.height=f.CANVAS_HEIGHT+"px"}}async animateAction(e,o,s){const i=this.getPlayerColor(s);let r=0;const l=async()=>{b(this),q(this.context,{x:3*a.PIECE_RADIUS*o+a.MASK_X_BEGIN+2*a.PIECE_RADIUS,y:r+a.MASK_Y_BEGIN+2*a.PIECE_RADIUS,r:a.PIECE_RADIUS,fillStyle:i,strokeStyle:a.PIECE_STROKE_STYLE}),this.render(),r+=a.PIECE_RADIUS};for(;e*3*a.PIECE_RADIUS>=r;)await H(),l()}render(){oe(this);for(let e=0;e<a.ROWS;e++)for(let o=0;o<a.COLUMNS;o++)q(this.context,{x:3*a.PIECE_RADIUS*o+a.MASK_X_BEGIN+2*a.PIECE_RADIUS,y:3*a.PIECE_RADIUS*e+a.MASK_Y_BEGIN+2*a.PIECE_RADIUS,r:a.PIECE_RADIUS,fillStyle:this.getPlayerColor(this.map[e][o]),strokeStyle:a.PIECE_STROKE_STYLE})}async applyPlayerAction(e,o){if(this.map[0][o]!==h.EMPTY||o<0||o>=a.COLUMNS)return!1;let s=!1,i=0;for(let r=0;r<a.ROWS-1;r++)if(this.map[r+1][o]!==h.EMPTY){s=!0,i=r;break}return s||(i=a.ROWS-1),await this.animateAction(i,o,e.boardPiece),this.map[i][o]=e.boardPiece,this.debug(),await H(),this.render(),!0}}function _(t=""){const n=document.querySelector(".message");if(!n)return console.error("Message DOM is null!");n.classList.remove("hidden");const e=document.querySelector(".message-body-content");if(!e)return console.error("Message body content DOM is null!");e.innerHTML=t;const o=document.querySelector(".message-body-dismiss");if(!o)return console.error("Message body dismiss DOM is null!");const s=()=>{n.classList.add("invisible"),n.addEventListener("transitionend",()=>{n.classList.add("hidden"),n.classList.remove("invisible")}),o.removeEventListener("click",s)};o.addEventListener("click",s)}const I={totalGames:0,humanWins:0,aiWins:0,draws:0};function T(t){I.totalGames++,t==="human"?I.humanWins++:t==="ai"?I.aiWins++:I.draws++,V()}function V(){document.getElementById("total-games").textContent=I.totalGames.toString(),document.getElementById("human-wins").textContent=I.humanWins.toString(),document.getElementById("ai-wins").textContent=I.aiWins.toString(),document.getElementById("draws").textContent=I.draws.toString()}V();const z="c4_leaderboard";function J(){const t=localStorage.getItem(z);return t?JSON.parse(t):[]}function re(t){localStorage.setItem(z,JSON.stringify(t))}function W(t,n){if(!t)return;const e=J();let o=e.find(s=>s.name===t);o||(o={name:t,totalGames:0,wins:0,losses:0,draws:0},e.push(o)),o.totalGames++,n==="win"?o.wins++:n==="loss"?o.losses++:o.draws++,e.sort((s,i)=>{const r=s.wins/s.totalGames||0;return(i.wins/i.totalGames||0)-r}),re(e),k()}function k(){const t=J(),n=document.getElementById("leaderboard-body");n&&(n.innerHTML="",t.forEach((e,o)=>{const s=document.createElement("tr"),i=(e.wins/e.totalGames*100||0).toFixed(1);s.innerHTML=`
      <td>${o+1}</td>
      <td>${e.name}</td>
      <td>${e.totalGames}</td>
      <td>${e.wins}</td>
      <td>${e.losses}</td>
      <td>${e.draws}</td>
      <td>${i}%</td>
    `,n.appendChild(s)}))}k();const D=document.querySelector(".statusbox"),P=document.querySelector(".statusbox-body-game"),x=document.querySelector(".statusbox-body-connection"),w=document.querySelector(".statusbox-body-player");class j extends Q{constructor(n,e){super(n,e)}beforeMoveApplied(){P&&(P.textContent=`Dropping ${this.currentPlayerId===0?"🔴":"🔵"} disc`)}waitingForMove(){!this.isMoveAllowed||this.isGameWon||(P&&(P.textContent="Wating for move"),w&&(w.textContent=this.currentPlayerId===0?"Player 1 🔴":"Player 2 🔵"))}afterMove(){}announceWinner(n){var s;if(super.announceWinner(n),n===h.EMPTY)return;let e="<h1>Thank you for playing.</h1>";const o=((s=document.getElementById("player-name"))==null?void 0:s.value)||"Unknown Player";if(n===h.DRAW)e+="It's a draw",T("draw"),this.players[1]instanceof p&&W(o,"draw");else{e+=`Player ${n} wins`;const i=n===h.PLAYER_1;this.players[1]instanceof p&&(i?(T("human"),W(o,"win")):(T("ai"),W(o,"loss")))}e+=".<br />After dismissing this message, click the board to reset game.",_(e),P&&(P.textContent="Game over"),w&&(w.textContent=n===h.DRAW?"It's a draw":`Player ${n===h.PLAYER_1?"1 🔴":"2 🔵"} wins`)}}function Z(t,n){const e=document.querySelector("canvas");if(!e){console.error("Canvas DOM is null");return}const o=new f(e),s=new g(h.PLAYER_1),i=new t([s,n],o);D==null||D.classList.remove("hidden"),x==null||x.classList.add("hidden"),i.start(),P&&(P.textContent="Wating for move"),w&&(w.textContent="Player 1 🔴"),e.addEventListener("click",async r=>{if(i.isGameWon)i.reset(),await H(),i.start();else{const l=e.getBoundingClientRect(),d=r.clientX-l.left,E=r.clientY-l.top,y=$({x:d,y:E});i.currentPlayerId===0?s.doAction(y):i.currentPlayerId===1&&n instanceof g&&n.doAction(y)}})}class ae extends j{}function ce(){Z(ae,new g(h.PLAYER_2))}class le extends j{}function de(){Z(le,new p(h.PLAYER_2))}var M=(t=>(t[t.FIRST=h.PLAYER_1]="FIRST",t[t.SECOND=h.PLAYER_2]="SECOND",t))(M||{});const G=document.querySelector(".statusbox"),A=document.querySelector(".statusbox-body-game"),R=document.querySelector(".statusbox-body-connection"),S=document.querySelector(".statusbox-body-player"),ue={}.C4_SERVER_ENDPOINT?{}.C4_SERVER_ENDPOINT:"wss://c4-server.fly.dev/";class he extends Q{constructor(e,o,{gameMode:s}){super(e,o);c(this,"connectionPlayerId",null);c(this,"connectionMatchId",null);c(this,"ws",null);c(this,"gameMode");c(this,"playerMain");c(this,"playerShadow");c(this,"initMatch",()=>{this.ws&&this.ws.send(v(C.NEW_MATCH_REQUEST,{playerId:this.connectionPlayerId}))});c(this,"connectToMatch",e=>{this.ws&&this.ws.send(v(C.CONNECT_MATCH_REQUEST,{playerId:this.connectionPlayerId,matchId:e}))});c(this,"messageActionHandler",e=>{var o;switch(e.type){case C.NEW_PLAYER_CONNECTION_OK:if(this.connectionPlayerId=e.payload.playerId,this.gameMode===M.FIRST)this.initMatch();else if(this.gameMode===M.SECOND){const i=new URLSearchParams(location.search).get("matchId");if(!i)return;this.connectToMatch(i)}break;case C.NEW_MATCH_OK:{this.connectionMatchId=e.payload.matchId;const s=`${location.href}?matchId=${this.connectionMatchId}`;console.log("[url] Share this",s),_(`<h1>Share this URL</h1>Please share this URL to your friend to start the game: <input type="text" id="copy-box" class="copy-box" readonly value="${s}" /><button type="button" id="copy-button">Copy</button>`);const i=document.getElementById("copy-box");i.focus(),i.select(),(o=document.getElementById("copy-button"))==null||o.addEventListener("click",()=>{i==null||i.select(),i==null||i.setSelectionRange(0,99999),document.execCommand("copy")})}break;case C.CONNECT_MATCH_OK:this.connectionMatchId=e.payload.matchId;break;case C.CONNECT_MATCH_FAIL:_("<h1>Error</h1> Failed to connect to match."),R&&(R.textContent="Connection error");break;case C.GAME_READY:_(`<h1>Game started</h1> The first piece should be dropped by ${this.isCurrentMoveByCurrentPlayer()?"you":"the other player"}`),A&&(A.textContent="Wating for move"),S&&(S.textContent=(this.currentPlayerId===0?"Player 1 🔴":"Player 2 🔵")+" "+(this.isCurrentMoveByCurrentPlayer()?"(you)":"(the other player)")),this.start();break;case C.MOVE_SHADOW:this.playerShadow.doAction(e.payload.column);break;case C.GAME_ENDED:{const{winnerBoardPiece:s}=e.payload,i=s===h.DRAW?"It's a draw":`Player ${s===h.PLAYER_1?"1 🔴":"2 🔵"} wins`;_("<h1>Thank you for playing</h1>"+i+"<br />Next game will be started in 10 seconds."),A&&(A.textContent="Game over"),S&&(S.textContent=i)}break;case C.GAME_RESET:this.reset();break;case C.OTHER_PLAYER_HUNGUP:_("<h1>Other player disconnected</h1> Please reload the page to start a new match");break}});c(this,"beforeMoveApplied",()=>{A&&(A.textContent=`Dropping ${this.currentPlayerId===0?"🔴":"🔵"} disc`)});c(this,"waitingForMove",()=>{A&&(A.textContent="Wating for move"),S&&(S.textContent=(this.currentPlayerId===0?"Player 1 🔴":"Player 2 🔵")+" "+(this.isCurrentMoveByCurrentPlayer()?"(you)":"(the other player)"))});c(this,"afterMove",e=>{this.ws&&this.isCurrentMoveByCurrentPlayer()&&this.ws.send(v(C.MOVE_MAIN,{playerId:this.connectionPlayerId,matchId:this.connectionMatchId,column:e}))});this.gameMode=s,s===M.FIRST?(this.playerMain=e[0],this.playerShadow=e[1]):(this.playerMain=e[1],this.playerShadow=e[0]),this.initConnection()}initConnection(){this.connectionPlayerId=null,this.connectionMatchId=null,this.ws&&this.ws.close();const e=()=>{this.isMoveAllowed=!1,R&&(R.textContent="Disconnected from server"),A&&(A.textContent="Game over"),S&&(S.textContent="Disconnected from match")};this.ws=new WebSocket(ue),this.ws.addEventListener("message",o=>{this.messageActionHandler(se(o.data))}),this.ws.addEventListener("open",()=>{this.ws&&this.ws.send(v(C.NEW_PLAYER_CONNECTION_REQUEST)),R&&(R.textContent="Connected to server")}),this.ws.addEventListener("close",o=>{console.log("[ws] close event",o),e()}),this.ws.addEventListener("error",o=>{console.log("[ws] error event",o),e()})}isCurrentMoveByCurrentPlayer(){return this.currentPlayerId+1===this.gameMode}announceWinner(e){super.announceWinner(e)}}function F(){const t=document.querySelector("canvas");if(!t){console.error("Canvas DOM is null");return}const o=new URLSearchParams(location.search).get("matchId")?M.SECOND:M.FIRST,s=new f(t),i=o===M.FIRST?[new g(h.PLAYER_1),new K(h.PLAYER_2)]:[new K(h.PLAYER_1),new g(h.PLAYER_2)],r=new he(i,s,{gameMode:o});G==null||G.classList.remove("hidden"),t.addEventListener("click",async l=>{if(!r.isGameWon){const d=t.getBoundingClientRect(),E=l.clientX-d.left,y=l.clientY-d.top,m=$({x:E,y});r.playerMain.doAction(m)}})}V();k();document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector("canvas");if(!t){console.error("Canvas DOM is null");return}if(new f(t).render(),new URLSearchParams(location.search).get("matchId")){F();const i=document.querySelector(".mode");i&&i.classList.add("hidden")}const s=document.querySelector(".mode-chooser-submit");s&&s.addEventListener("click",()=>{if(!document.getElementById("player-name").value.trim()){alert("请输入您的名字！");return}const r=document.querySelector(".mode");if(r){const l=document.querySelectorAll(".mode-chooser-input");let d=null;for(let E=0;E<l.length&&(d=l[E].checked?l[E].value:null,!d);E++);d||(d="offline-ai"),d==="offline-human"?ce():d==="offline-ai"?de():d==="online-human"&&F(),r.classList.add("invisible"),r.addEventListener("transitionend",()=>{r.classList.add("hidden")})}})});
